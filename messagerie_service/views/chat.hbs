<div class="chat-container">
    <div class="chat-header">
        <div class="sender-avatar" style="background: linear-gradient(135deg, #ed8936, #dd6b20);">
            {{#if otherUser.nom}}
                {{otherUser.nom}}
            {{else}}
                U
            {{/if}}
        </div>
        <div>
            <div style="font-weight: 600; font-size: 18px; color: #2d3748;">
                {{otherUser.nom}} {{otherUser.prenom}}
            </div>
            <div style="font-size: 12px; color: #718096;">En ligne</div>
        </div>
    </div>

    <div class="chat-messages" id="chatMessages">
        {{#each messages}}
            {{#if (eq id_expediteur ../userId)}}
                <!-- Mes messages à droite -->
                <div class="message sent">
                    <div class="message-bubble">
                        {{contenu}}
                    </div>
                    <div class="message-time">{{date}}</div>
                </div>
            {{else}}
                <!-- Leurs messages à gauche -->
                <div class="message received">
                    <div class="message-bubble">
                        <div style="font-size: 12px; font-weight: 600; margin-bottom: 4px; opacity: 0.8;">
                            {{expediteur.prenom}}
                        </div>
                        {{contenu}}
                    </div>
                    <div class="message-time">{{date}}</div>
                </div>
            {{/if}}
        {{/each}}
    </div>

    <form method="POST" action="/chat/{{userId}}/{{otherUser.id}}" class="message-form">
        <div class="form-group">
            <input 
                type="text" 
                name="contenu" 
                placeholder="Tapez un message..." 
                required 
                class="message-input"
            >
            <button type="submit" class="send-button">
                <span style="font-size: 18px;">➤</span>
            </button>
        </div>
    </form>
</div>

<script>
    // Auto-scroll to bottom of chat
    document.addEventListener('DOMContentLoaded', function() {
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    });
</script>